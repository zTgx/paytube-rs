# PayTube

A reference implementation of an off-chain [state channel](https://ethereum.org/en/developers/docs/scaling/state-channels/)
built using [Anza's SVM API](https://www.anza.xyz/blog/anzas-new-svm-api).

## Overview

PayTube is an SVM-based payment channel that enables two or more parties to exchange SOL or SPL tokens off-chain. The channel is initialized by a "VM" (in this case, a Rust program) and, once transactions are complete, the final payment ledger is submitted to the Solana blockchain for settlement.

## Key Features

*   **Off-Chain Transactions:** Facilitates rapid, low-cost transactions without the overhead of on-chain processing for each transfer.
*   **SVM-Based:** Leverages the Solana SVM for transaction processing within the channel.
*   **Settlement to Solana:** Ensures final balances are reflected on the Solana blockchain.
*   **Native SOL and SPL Token Support:** Supports transfers of both native SOL and SPL tokens.

## Architecture

1.  **Channel Initialization:** A [`PayTubeChannel`](src/lib.rs) is created with a set of keys and an [`RpcClient`](src/lib.rs).
2.  **Transaction Processing:** [`PayTubeTransaction`](src/transaction.rs) objects are processed by the [`PayTubeChannel::process_paytube_transfers`](src/lib.rs) method. This involves:

    *   Conversion to SVM-compatible transactions.
    *   Execution within the SVM using a [`TransactionBatchProcessor`](src/processor.rs).
    *   Account loading via [`PayTubeAccountLoader`](src/loader.rs).
3.  **Settlement:** The final ledger is generated by the [`PayTubeSettler`](src/settler.rs), which creates and submits settlement transactions to the Solana blockchain.

## Modules

*   [`src/lib.rs`](src/lib.rs): Main library file, defining the [`PayTubeChannel`](src/lib.rs) and its methods.
*   [`src/loader.rs`](src/loader.rs): Implements the [`PayTubeAccountLoader`](src/loader.rs) for loading accounts into the SVM.
*   [`src/log.rs`](src/log.rs): Provides logging utilities.
*   [`src/processor.rs`](src/processor.rs): Contains the [`TransactionBatchProcessor`](src/processor.rs) and related functions for processing transactions within the SVM.
*   [`src/settler.rs`](src/settler.rs): Implements the [`PayTubeSettler`](src/settler.rs) for settling the final ledger to the Solana blockchain.
*   [`src/transaction.rs`](src/transaction.rs): Defines the [`PayTubeTransaction`](src/transaction.rs) structure and related utilities.

## Getting Started

### Prerequisites

*   Rust toolchain
*   Solana CLI

### Building

```bash
cargo build
```

## SVM API

<p align="center">
  <img src="docs/svm-api.avif" alt="SVM API" width="500"/>
</p>
